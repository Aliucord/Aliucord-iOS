function modulesBlacklist(e){return e>=941&&e<=969||e==199||e==432||e==433||e==444||e==445||e==456}function getModule(e,t=!0){const n=Object.keys(modules).map(s=>Number(s)).find(s=>{if(!modulesBlacklist(s))return __r(s)&&e(__r(s))});if(n===void 0)return null;const u=modules[n].publicModule;return t?u.exports:u}function getModules(e){return Object.keys(modules).map(n=>Number(n)).filter(n=>{if(!modulesBlacklist(n))return __r(n)&&e(__r(n))})}const assetsModule=getModule(e=>e.registerAsset);function getAssetByName(e){let t,n=1;for(;t=assetsModule.getAssetByID(n),!(t===void 0||t.name===e);)n++;return{id:n,...t}}function getAssets(){const e=[];let t=1;for(;;){const n=assetsModule.getAssetByID(t);if(n===void 0)break;e.push({id:t,...n}),t++}return e}const clydeModule=getModule(e=>{var t;return(t=e.default)==null?void 0:t.sendBotMessage});function sendReply(e,t){clydeModule.default.sendBotMessage(e,t)}const commandsModule=getModule(e=>e.getBuiltInCommands);function registerCommands(e){commandsModule.BUILT_IN_COMMANDS.push(...e)}const dialogModule=getModule(e=>{var t;return(t=e.default)==null?void 0:t.show});function showDialog(e){dialogModule.default.show(e)}const nativeModules=getModule(e=>e.NativeModules).NativeModules;function reloadDiscord(){nativeModules.BundleUpdaterManager.reload()}function getVersion(){return nativeModules.InfoDictionaryManager.Version}function getBuild(){return nativeModules.InfoDictionaryManager.Build}function getDevice(){return nativeModules.DCDDeviceManager.device}function getSystemVersion(){return nativeModules.DCDDeviceManager.systemVersion}const restModule=getModule(e=>{var t;return(t=e.default)==null?void 0:t.getAPIBaseURL});async function get(e){return restModule.default.get(e)}async function post(e){return restModule.default.post(e)}async function put(e){return restModule.default.put(e)}async function patch(e){return restModule.default.patch(e)}async function _delete(e){return restModule.default.delete(e)}async function getAPIBaseURL(){return restModule.default.getAPIBaseURL()}const storageModule=getModule(e=>e.getItem);async function getItem(e){return storageModule.getItem(e)}async function setItem(e,t){return storageModule.setItem(e,t)}async function removeItem(e){return storageModule.removeItem(e)}const toastModule=getModule(e=>{var t,n,u,s,c;return((t=e.default)==null?void 0:t.open)&&((n=e.default)==null?void 0:n.close)&&!((u=e.default)==null?void 0:u.openLazy)&&!((s=e.default)==null?void 0:s.startDrag)&&!((c=e.default)==null?void 0:c.init)});function showToast(e){toastModule.default.open(e)}const tokenModule=getModule(e=>{var t;return(t=e.default)==null?void 0:t.setToken});function getToken(){return tokenModule.default.getToken()}function setToken(e){return tokenModule.default.setToken(e)}function hideToken(){tokenModule.default.hideToken()}function showToken(){tokenModule.default.showToken()}function removeToken(){tokenModule.default.removeToken()}const userModule=getModule(e=>e.fetchProfile);async function fetchCurrentUser(){return userModule.fetchCurrentUser()}async function fetchProfile(e){return userModule.fetchProfile(e)}async function getUser(e){return userModule.getUser(e)}function prepareApi(){window.getAssetByName=getAssetByName,window.getAssets=getAssets,window.aliucord={getModule,getModules,getAssetByName,getAssets,clyde:{sendReply},commands:{registerCommands},dialog:{showDialog},native:{reloadDiscord,getVersion,getBuild,getDevice,getSystemVersion},rest:{get,post,put,patch,delete:_delete,getAPIBaseURL},storage:{getItem,setItem,removeItem},toast:{showToast},token:{getToken,setToken,hideToken,showToken,removeToken},users:{fetchCurrentUser,fetchProfile,getUser}}}let socket;function setUpDebugWS(){connectWebsocket("localhost:9090");const e=nativeLoggingHook;globalThis.nativeLoggingHook=(t,n)=>((socket==null?void 0:socket.readyState)===WebSocket.OPEN&&socket.send(JSON.stringify({level:n,message:t})),e(t,n))}function connectWebsocket(host){console.log("Connecting to debug ws"),socket!==void 0&&socket.readyState!==WebSocket.CLOSED&&(socket.close(),socket=null),socket=new WebSocket(`ws://${host}`),socket.addEventListener("open",()=>{console.log("Connected with debug websocket"),showToast({content:"Connected to the websocket server."})}),socket.addEventListener("error",e=>{console.log("Error with debug websocket: ",e.message),showToast({content:"An error occured with the websocket connection."})}),socket.addEventListener("close",e=>{console.log("Error with debug websocket: ",e.message),showToast({content:"The websocket connection has been closed."})}),socket.addEventListener("message",message=>{try{console.log(eval(message.data))}catch(e){console.error(e)}})}function sendMessage(e){(socket==null?void 0:socket.readyState)===WebSocket.OPEN&&socket.send(e)}var commands={};Object.defineProperty(commands,"__esModule",{value:!0}),commands.InteractionTypes=ApplicationCommandOptionType_1=commands.ApplicationCommandOptionType=commands.ApplicationCommandPermissionType=ApplicationCommandInputType_1=commands.ApplicationCommandInputType=ApplicationCommandType_1=commands.ApplicationCommandType=commands.ApplicationCommandSectionType=void 0;var ApplicationCommandSectionType;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(ApplicationCommandSectionType||(ApplicationCommandSectionType={})),commands.ApplicationCommandSectionType=ApplicationCommandSectionType;var ApplicationCommandType;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(ApplicationCommandType||(ApplicationCommandType={}));var ApplicationCommandType_1=commands.ApplicationCommandType=ApplicationCommandType,ApplicationCommandInputType;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(ApplicationCommandInputType||(ApplicationCommandInputType={}));var ApplicationCommandInputType_1=commands.ApplicationCommandInputType=ApplicationCommandInputType,ApplicationCommandPermissionType;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(ApplicationCommandPermissionType||(ApplicationCommandPermissionType={})),commands.ApplicationCommandPermissionType=ApplicationCommandPermissionType;var ApplicationCommandOptionType;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number"})(ApplicationCommandOptionType||(ApplicationCommandOptionType={}));var ApplicationCommandOptionType_1=commands.ApplicationCommandOptionType=ApplicationCommandOptionType,InteractionTypes;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(InteractionTypes||(InteractionTypes={})),commands.InteractionTypes=InteractionTypes;var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return typeof e=="string"&&REGEX.test(e)}for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase();if(!validate(n))throw TypeError("Stringified UUID is invalid");return n}function v4(e,t,n){e=e||{};var u=e.random||(e.rng||rng)();if(u[6]=u[6]&15|64,u[8]=u[8]&63|128,t){n=n||0;for(var s=0;s<16;++s)t[n+s]=u[s];return t}return stringify(u)}const linkingModule=getModule(e=>e.openURL);async function sendCommand(e,t=[]){return new Promise((n,u)=>{const s=v4(),c={command:e,id:s,params:t};linkingModule.openURL(`aliucord://${JSON.stringify(c)}`).then(()=>{const r=linkingModule.addEventListener("url",l=>{let o=l.url;if(!!o.includes("aliucord://")){o=decodeURIComponent(o.replace("aliucord://",""));try{const a=JSON.parse(o);if(a.id!==s||a.data===void 0)return;r.remove(),n(a)}catch{return}}})})})}const aliucordSection={id:"-3",type:0,name:"Aliucord"};function injectPluginsManager(){const e=getModule(r=>r.getBuiltInCommands,!1),t=e.exports.BUILT_IN_SECTIONS;e.exports.BUILT_IN_SECTIONS={...t,[aliucordSection.id]:aliucordSection};const n={id:"installed-plugins",applicationId:aliucordSection.id,name:"plugins",description:"List installed plugins.",type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,execute:(r,l)=>{const o=l.channel;sendCommand("list-plugins").then(a=>{const d=a.data;sendReply(o.id,d==""?"No plugins installed.":`**Plugins installed (${d.split(",").length})**: ${d.split(",").join(", ")}`)})}},u={id:"install-plugin",applicationId:aliucordSection.id,name:"install",description:"Install a plugin.",type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,options:[{name:"plugin",description:"Plugin url",required:!0,type:ApplicationCommandOptionType_1.String}],execute:(r,l)=>{const o=r[0].value,a=l.channel;sendCommand("install-plugin",[o]).then(d=>{sendReply(a.id,d.data)})}},s={id:"uninstall-plugin",applicationId:aliucordSection.id,name:"uninstall",description:"Uninstall a plugin.",type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,options:[{name:"plugin",description:"Plugin name",required:!0,type:ApplicationCommandOptionType_1.String}],execute:(r,l)=>{const o=r[0].value,a=l.channel;sendCommand("uninstall-plugin",[o]).then(d=>{sendReply(a.id,d.data)})}};registerCommands([n,u,s])}function injectCommands(){const e=[{id:"websocket-devtools",name:"websocket",description:"Connect to the websocket devtools.",applicationId:aliucordSection.id,type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,options:[{name:"host",description:"Host of the debugger.",type:ApplicationCommandOptionType_1.String,required:!0}],execute:t=>{const n=t[0].value;connectWebsocket(n)}},{id:"debug-command",name:"debug",description:"Print out your device information.",applicationId:aliucordSection.id,type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltInText,execute:()=>{let t=`**Debug Info:**
`;return t+=`> Discord: ${getVersion()} (${getBuild()})
`,t+=`> Device: ${getDevice()}
`,t+=`> System: ${getSystemVersion()}
`,{content:t}}},{id:"reload-command",name:"reload",description:"Reload Discord.",applicationId:aliucordSection.id,type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,execute:function(t){reloadDiscord()}},{id:"token-command",name:"token",description:"Show your Discord'token.",applicationId:aliucordSection.id,type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,execute:function(t,n){const u=getToken(),s=n.channel.id;sendReply(s,`\`${u}\``)}},{id:"dump-command",name:"dump",description:"Dump Discord's modules.",applicationId:aliucordSection.id,type:ApplicationCommandType_1.Chat,inputType:ApplicationCommandInputType_1.BuiltIn,execute:function(t,n){var u;const s=n.channel.id,c=window.modules,r=l=>{let o=[];return JSON.stringify(l,(a,d)=>{try{if(typeof d=="object"&&d!==null){if(o.includes(d))return;o.push(d)}return typeof d=="function"&&d!==null?o.includes(a)?void 0:(o.push(a),"[Function]"):d}catch{}})};for(const l of Object.keys(c))try{const o=c[l],a={id:l};o.publicModule.exports&&(typeof o.publicModule.exports=="function"?a.exports=`[Function: ${o.publicModule.exports.name}]`:a.exports=JSON.parse(r(o.publicModule.exports))),((u=o.publicModule)==null?void 0:u.exports.default)&&(typeof o.publicModule.exports.default=="function"?(a.default=`[Function: ${o.publicModule.exports.default.name}]`,a.protoype=Object.getOwnPropertyNames(o.publicModule.exports.default.prototype)):a.default=Object.keys(o.publicModule.exports.default)),sendMessage(JSON.stringify(a,null,"	"))}catch(o){console.log(`Couldn't dump module ${l}`),console.log(o)}sendReply(s,"Modules has been dumped.")}}];registerCommands(e)}try{prepareApi(),setUpDebugWS(),injectPluginsManager(),injectCommands()}catch(e){console.error(e)}
