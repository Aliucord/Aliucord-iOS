let socket;function setUpDebugWS(){connectWebsocket("localhost:9090");const e=nativeLoggingHook;globalThis.nativeLoggingHook=(t,o)=>((socket==null?void 0:socket.readyState)===WebSocket.OPEN&&socket.send(JSON.stringify({level:o,message:t})),e(t,o))}function connectWebsocket(host){console.log("Connecting to debug ws"),socket!==void 0&&socket.readyState!==WebSocket.CLOSED&&(socket.close(),socket=null),socket=new WebSocket(`ws://${host}`),socket.addEventListener("open",()=>console.log("Connected with debug websocket")),socket.addEventListener("error",e=>console.log("Error with debug websocket: ",e.message)),socket.addEventListener("message",message=>{try{console.log(eval(message.data))}catch(e){console.error(e)}})}var commonjsGlobal=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},dist={},commands$1={};Object.defineProperty(commands$1,"__esModule",{value:!0}),commands$1.registerCommands=commands$1.AliucordSectionID=void 0;const commandsModule=window.getModule(e=>e.getBuiltInCommands,!1),AliucordSectionID="-3";commands$1.AliucordSectionID=AliucordSectionID;function registerCommands(e){commandsModule.exports.BUILT_IN_COMMANDS.push(...e)}commands$1.registerCommands=registerCommands;var clyde={};Object.defineProperty(clyde,"__esModule",{value:!0}),clyde.sendReply=void 0;const clydeModule=window.getModule(e=>{var t;return(t=e.default)===null||t===void 0?void 0:t.sendBotMessage},!1);function sendReply(e,t){clydeModule.exports.default.sendBotMessage(e,t)}clyde.sendReply=sendReply;var dialog={};Object.defineProperty(dialog,"__esModule",{value:!0}),dialog.show=void 0;const dialogModule=window.getModule(e=>{var t;return(t=e.default)===null||t===void 0?void 0:t.show}).default;function show(e={title:"Default dialog"}){dialogModule.show(e)}dialog.show=show;var native={};Object.defineProperty(native,"__esModule",{value:!0}),native.getSystemVersion=native.getDevice=native.getBuild=native.getVersion=native.reloadDiscord=void 0;const nativeModules=window.getModule(e=>e.NativeModules).NativeModules;function reloadDiscord(){nativeModules.BundleUpdaterManager.reload()}native.reloadDiscord=reloadDiscord;function getVersion(){return nativeModules.InfoDictionaryManager.Version}native.getVersion=getVersion;function getBuild(){return nativeModules.InfoDictionaryManager.Build}native.getBuild=getBuild;function getDevice(){return nativeModules.DCDDeviceManager.device}native.getDevice=getDevice;function getSystemVersion(){return nativeModules.DCDDeviceManager.systemVersion}native.getSystemVersion=getSystemVersion;var rest={};Object.defineProperty(rest,"__esModule",{value:!0}),rest.getAPIBaseURL=rest.delete=rest.patch=rest.put=rest.post=rest.get=void 0;const restModule=window.getModule(e=>{var t;return(t=e.default)===null||t===void 0?void 0:t.getAPIBaseURL});async function get(e){return new Promise((t,o)=>{restModule.default.get(e).then(n=>{t(n)}).catch(n=>{o(n)})})}rest.get=get;async function post(e){return new Promise((t,o)=>{restModule.default.post(e).then(n=>{t(n)}).catch(n=>{o(n)})})}rest.post=post;async function put(e){return new Promise((t,o)=>{restModule.default.put(e).then(n=>{t(n)}).catch(n=>{o(n)})})}rest.put=put;async function patch(e){return new Promise((t,o)=>{restModule.default.patch(e).then(n=>{t(n)}).catch(n=>{o(n)})})}rest.patch=patch;async function _delete(e){return new Promise((t,o)=>{restModule.default.delete(e).then(n=>{t(n)}).catch(n=>{o(n)})})}rest.delete=_delete;async function getAPIBaseURL(){return restModule.default.getAPIBaseURL()}rest.getAPIBaseURL=getAPIBaseURL;var storage={};Object.defineProperty(storage,"__esModule",{value:!0}),storage.removeItem=storage.setItem=storage.getItem=void 0;const storageModule=window.getModule(e=>e.getItem);async function getItem(e){return new Promise((t,o)=>{storageModule.getItem(e).then(n=>{t(n)}).catch(n=>{o(n)})})}storage.getItem=getItem;async function setItem(e,t){return new Promise((o,n)=>{storageModule.setItem(e,t).then(()=>{o()}).catch(s=>{n(s)})})}storage.setItem=setItem;async function removeItem(e){return new Promise((t,o)=>{storageModule.removeItem(e).then(()=>{t()}).catch(n=>{o(n)})})}storage.removeItem=removeItem;var users={};Object.defineProperty(users,"__esModule",{value:!0}),users.getUser=users.fetchProfile=users.fetchCurrentUser=void 0;const userModule=window.getModule(e=>e.fetchProfile);async function fetchCurrentUser(){return new Promise((e,t)=>{userModule.fetchCurrentUser().then(o=>{e(o)}).catch(t)})}users.fetchCurrentUser=fetchCurrentUser;async function fetchProfile(e){return new Promise((t,o)=>{userModule.fetchProfile(e).then(n=>{t(n)}).catch(o)})}users.fetchProfile=fetchProfile;async function getUser(e){return new Promise((t,o)=>{userModule.getUser(e).then(n=>{t(n)}).catch(o)})}users.getUser=getUser;var __createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,o,n){n===void 0&&(n=o),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[o]}})}:function(e,t,o,n){n===void 0&&(n=o),e[n]=t[o]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var o in e)o!=="default"&&Object.prototype.hasOwnProperty.call(e,o)&&__createBinding(t,e,o);return __setModuleDefault(t,e),t};Object.defineProperty(dist,"__esModule",{value:!0}),dist.Users=dist.Storage=dist.Rest=dist.Native=dist.Dialog=Commands_1=dist.Commands=Clyde_1=dist.Clyde=void 0;const Commands=__importStar(commands$1);var Commands_1=dist.Commands=Commands;const Clyde=__importStar(clyde);var Clyde_1=dist.Clyde=Clyde;const Dialog=__importStar(dialog);dist.Dialog=Dialog;const Native=__importStar(native);dist.Native=Native;const Rest=__importStar(rest);dist.Rest=Rest;const Storage=__importStar(storage);dist.Storage=Storage;const Users=__importStar(users);dist.Users=Users;var commands={};Object.defineProperty(commands,"__esModule",{value:!0}),commands.InteractionTypes=ApplicationCommandOptionType_1=commands.ApplicationCommandOptionType=commands.ApplicationCommandPermissionType=ApplicationCommandType_1=commands.ApplicationCommandType=ApplicationCommandTarget_1=commands.ApplicationCommandTarget=commands.ApplicationCommandSectionType=void 0;var ApplicationCommandSectionType;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.Guild=1]="Guild",e[e.DM=2]="DM"})(ApplicationCommandSectionType||(ApplicationCommandSectionType={})),commands.ApplicationCommandSectionType=ApplicationCommandSectionType;var ApplicationCommandTarget;(function(e){e[e.Chat=1]="Chat",e[e.User=2]="User",e[e.Message=3]="Message"})(ApplicationCommandTarget||(ApplicationCommandTarget={}));var ApplicationCommandTarget_1=commands.ApplicationCommandTarget=ApplicationCommandTarget,ApplicationCommandType;(function(e){e[e.BuiltIn=0]="BuiltIn",e[e.BuiltInText=1]="BuiltInText",e[e.BuiltInIntegration=2]="BuiltInIntegration",e[e.Bot=3]="Bot",e[e.Placeholder=4]="Placeholder"})(ApplicationCommandType||(ApplicationCommandType={}));var ApplicationCommandType_1=commands.ApplicationCommandType=ApplicationCommandType,ApplicationCommandPermissionType;(function(e){e[e.Role=1]="Role",e[e.User=2]="User"})(ApplicationCommandPermissionType||(ApplicationCommandPermissionType={})),commands.ApplicationCommandPermissionType=ApplicationCommandPermissionType;var ApplicationCommandOptionType;(function(e){e[e.SubCommand=1]="SubCommand",e[e.SubCommandGroup=2]="SubCommandGroup",e[e.String=3]="String",e[e.Integer=4]="Integer",e[e.Boolean=5]="Boolean",e[e.User=6]="User",e[e.Channel=7]="Channel",e[e.Role=8]="Role",e[e.Mentionnable=9]="Mentionnable",e[e.Number=10]="Number"})(ApplicationCommandOptionType||(ApplicationCommandOptionType={}));var ApplicationCommandOptionType_1=commands.ApplicationCommandOptionType=ApplicationCommandOptionType,InteractionTypes;(function(e){e[e.ApplicationCommand=2]="ApplicationCommand",e[e.MessageComponent=3]="MessageComponent"})(InteractionTypes||(InteractionTypes={})),commands.InteractionTypes=InteractionTypes;function getModule(e,t=!0){const o=Object.keys(modules).map(s=>Number(s)).find(s=>s>=940&&s<=968||s==199||s==432||s==433||s==444||s==445||s==456?!1:__r(s)&&e(__r(s)));if(o===void 0)return null;const n=modules[o].publicModule;return t?n.exports:n}window.getModule=getModule;var getRandomValues,rnds8=new Uint8Array(16);function rng(){if(!getRandomValues&&(getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!getRandomValues))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return getRandomValues(rnds8)}var REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function validate(e){return typeof e=="string"&&REGEX.test(e)}for(var byteToHex=[],i=0;i<256;++i)byteToHex.push((i+256).toString(16).substr(1));function stringify(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=(byteToHex[e[t+0]]+byteToHex[e[t+1]]+byteToHex[e[t+2]]+byteToHex[e[t+3]]+"-"+byteToHex[e[t+4]]+byteToHex[e[t+5]]+"-"+byteToHex[e[t+6]]+byteToHex[e[t+7]]+"-"+byteToHex[e[t+8]]+byteToHex[e[t+9]]+"-"+byteToHex[e[t+10]]+byteToHex[e[t+11]]+byteToHex[e[t+12]]+byteToHex[e[t+13]]+byteToHex[e[t+14]]+byteToHex[e[t+15]]).toLowerCase();if(!validate(o))throw TypeError("Stringified UUID is invalid");return o}function v4(e,t,o){e=e||{};var n=e.random||(e.rng||rng)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){o=o||0;for(var s=0;s<16;++s)t[o+s]=n[s];return t}return stringify(n)}const linkingModule=getModule(e=>e.openURL);async function sendCommand(e,t=[]){return new Promise((o,n)=>{const s=v4(),d={command:e,id:s,params:t};linkingModule.openURL(`aliucord://${JSON.stringify(d)}`).then(()=>{const c=linkingModule.addEventListener("url",l=>{let a=l.url;if(!!a.includes("aliucord://")){a=decodeURIComponent(a.replace("aliucord://",""));try{const r=JSON.parse(a);if(r.id!==s||r.data===void 0)return;c.remove(),o(r)}catch{return}}})})})}function injectPluginsManager(){const e=getModule(l=>l.getBuiltInCommands,!1),t={id:"-3",type:0,name:"Aliucord"},o=e.exports.BUILT_IN_SECTIONS;e.exports.BUILT_IN_SECTIONS={...o,[t.id]:t};const n={id:"installed-plugins",applicationId:t.id,name:"plugins",description:"List installed plugins.",target:ApplicationCommandTarget_1.Chat,type:ApplicationCommandType_1.BuiltIn,execute:(l,a)=>{const r=a.channel;sendCommand("list-plugins").then(m=>{const u=m.data;Clyde_1.sendReply(r.id,u==""?"No plugins installed.":`**Plugins installed (${u.split(",").length})**: ${u.split(",").join(", ")}`)})}},s={id:"install-plugin",applicationId:t.id,name:"install",description:"Install a plugin.",target:ApplicationCommandTarget_1.Chat,type:ApplicationCommandType_1.BuiltIn,options:[{name:"plugin",description:"Plugin url",required:!0,type:ApplicationCommandOptionType_1.String}],execute:(l,a)=>{const r=l[0].value,m=a.channel;sendCommand("install-plugin",[r]).then(u=>{Clyde_1.sendReply(m.id,u.data)})}},d={id:"uninstall-plugin",applicationId:t.id,name:"uninstall",description:"Uninstall a plugin.",target:ApplicationCommandTarget_1.Chat,type:ApplicationCommandType_1.BuiltIn,options:[{name:"plugin",description:"Plugin name",required:!0,type:ApplicationCommandOptionType_1.String}],execute:(l,a)=>{const r=l[0].value,m=a.channel;sendCommand("uninstall-plugin",[r]).then(u=>{Clyde_1.sendReply(m.id,u.data)})}},c=[n,s,d];Commands_1.registerCommands(c)}function injectCommands(){const e=[{id:"websocket-devtools",name:"websocket",description:"Connect to the websocket devtools.",applicationId:Commands_1.AliucordSectionID,target:ApplicationCommandTarget_1.Chat,type:ApplicationCommandType_1.BuiltIn,options:[{name:"host",description:"Host of the debugger.",type:ApplicationCommandOptionType_1.String,required:!0}],execute:function(t,o){const n=t[0].value;connectWebsocket(n)}},{id:"debug-command",name:"doctor",description:"Print out your device information.",applicationId:Commands_1.AliucordSectionID,target:ApplicationCommandTarget_1.Chat,type:ApplicationCommandType_1.BuiltInText,execute:function(t){const o=getModule(c=>c.NativeModules).NativeModules,n=o.InfoDictionaryManager,s=o.DCDDeviceManager;let d=`**Debug Info:**
`;return d+=`> Discord: ${n.Version} (${n.Build})
`,d+=`> Device: ${s.device}
`,d+=`> System: ${s.systemVersion}
`,{content:d}}},{id:"reload-command",name:"reload",description:"Reload Discord.",applicationId:Commands_1.AliucordSectionID,target:ApplicationCommandTarget_1.Chat,type:ApplicationCommandType_1.BuiltIn,execute:function(t){getModule(o=>o.NativeModules).NativeModules.BundleUpdaterManager.reload()}}];Commands_1.registerCommands(e)}try{setUpDebugWS(),injectPluginsManager(),injectCommands()}catch(e){console.error(e)}
